---
title: "¿Qué tan bueno sos estimando la edad de las personas?"
format: html
---

# Bienvenidos a la actividad 'Adivinando edades'

## A continuación encontrarás las fotos y las estimaciones de edad de todos los estudiantes de seminarios de cuanti.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
# --- Load packages ---
if (!require("googlesheets4")) install.packages("googlesheets4")
if (!require("plotly")) install.packages("plotly")
library(googlesheets4)
library(plotly)

# --- Load data from Google Sheets ---
sheet_url <- "https://docs.google.com/spreadsheets/d/1rCIt7aM9HHY5gxjWZVtqXMmn-m4CEI85U_n6u5dpWsI"
# Skip authentication for public sheet
gs4_deauth()


# Read the single sheet and keep only relevant columns
read_sheet_safe <- function(sheet_url) {
  df <- read_sheet(sheet_url, sheet = "Edades")
  # Keep only columns for plotting
  df <- df[, c("Tus iniciales (dos letras)", 'CH','PM',	'LI',	'MM',	'FV',	'GH',	'PP',	'YG',	'OR',	'TR',	'BA',	'AW')]
  return(df)
}

# --- Plotting function ---
create_plots <- function(df, group_col, title) {
  df <- df[!is.na(df[[group_col]]), ]  # Remove NAs
  df$age <- as.numeric(df[[group_col]]) # Convert to numeric
  
  mean_age <- mean(df$age)
  median_age <- median(df$age)
  var_age <- var(df$age)
  sd_age <- sd(df$age)
  
  hist_counts <- hist(df$age, plot = FALSE)
  max_count <- max(hist_counts$counts)
  
  # Histogram
  hist <- plot_ly(df, x = ~age, type = "histogram",
                  marker = list(color = "#9bfa82", line = list(color = "#6446faff", width = 1)),
                  showlegend = FALSE) %>%
    add_trace(x = c(mean_age, mean_age), y = c(0, max_count), type = "scatter", mode = "lines",
              line = list(color = "#ff6b6b", width = 3), name = paste0("Media: ", round(mean_age,1)),
              showlegend = TRUE) %>%
    add_trace(x = c(median_age, median_age), y = c(0, max_count), type = "scatter", mode = "lines",
              line = list(color = "#6446faff", width = 3), name = paste0("Mediana: ", round(median_age,1)),
              showlegend = TRUE) %>%
    layout(
      bargap = 0,
      xaxis = list(title = "Edad"),
      yaxis = list(title = "Frecuencia"),
      annotations = list(
        x = 0.95, y = 0.95, xref = "paper", yref = "paper",
        text = paste0("Varianza: ", round(var_age,1), "<br>DE: ", round(sd_age,1)),
        showarrow = FALSE, font = list(size = 14)
      )
    )
  
  # Boxplot
  box <- plot_ly(df, x = ~age, type = "box", boxpoints = "all", jitter = 0.3,
                 orientation = "h", fillcolor = "#9bfa82",
                 marker = list(color = "#6446faff"),
                 line = list(color = "#6446faff"),
                 showlegend = FALSE) %>%
    layout(xaxis = list(title = "Edad"), yaxis = list(showticklabels = FALSE))
  
  return(subplot(hist, box, nrows = 2, margin = 0.07, shareX = TRUE, titleX = TRUE) %>%
           layout(title = title))
}

# Example usage:
all_data <- read_sheet_safe(sheet_url)

plots_ch <- create_plots(all_data, "CH", "CH: Distribución de edades")
plots_pm <- create_plots(all_data, "PM", "PM: Distribución de edades")
plots_li <- create_plots(all_data, "LI", "LI: Distribución de edades")
plots_mm <- create_plots(all_data, "MM", "MM: Distribución de edades")
plots_fv <- create_plots(all_data, "FV", "FV: Distribución de edades")
plots_gh <- create_plots(all_data, "GH", "GH: Distribución de edades")
plots_pp <- create_plots(all_data, "PP", "PP: Distribución de edades")
plots_yg <- create_plots(all_data, "YG", "YG: Distribución de edades")
plots_or <- create_plots(all_data, "OR", "OR: Distribución de edades")
plots_tr <- create_plots(all_data, "TR", "TR: Distribución de edades")
plots_ba <- create_plots(all_data, "BA", "BA: Distribución de edades")
plots_aw <- create_plots(all_data, "AW", "AW: Distribución de edades")

```

------------------------------------------------------------------------

## ¿Qué edad tiene CH?

![CH](images/CH_49.jpeg)


<details>

<summary>Mostrar gráficos de todas las estimaciones</summary>

```{r, echo=FALSE}
plots_ch
```

</details>

------------------------------------------------------------------------

## ¿Qué edad tiene PM?


![PM](images/PM_10.jpeg)

<details>

<summary>Mostrar gráficos de todas las estimaciones</summary>

```{r, echo=FALSE}
plots_pm
```

</details>


------------------------------------------------------------------------

## ¿Qué edad tiene LI?


![LI](images/LI_45.jpeg)
<details>

<summary>Mostrar gráficos de todas las estimaciones</summary>

```{r, echo=FALSE}
plots_li
```

</details>
------------------------------------------------------------------------

## ¿Qué edad tiene MM?


![MM](images/MM_63.jpeg)
<details>

<summary>Mostrar gráficos de todas las estimaciones</summary>

```{r, echo=FALSE}
plots_mm
```

</details>

------------------------------------------------------------------------

## ¿Qué edad tiene FV?


![FV](images/FV_17.jpeg)
<details>

<summary>Mostrar gráficos de todas las estimaciones</summary>

```{r, echo=FALSE}
plots_fv
```

</details>

------------------------------------------------------------------------

## ¿Qué edad tiene GH?


![GH](images/GH_76.jpeg)
<details>

<summary>Mostrar gráficos de todas las estimaciones</summary>

```{r, echo=FALSE}
plots_gh
```

</details>

------------------------------------------------------------------------

## ¿Qué edad tiene PP?


![PP](images/PP_13.jpeg)
<details>

<summary>Mostrar gráficos de todas las estimaciones</summary>

```{r, echo=FALSE}
plots_pp
```

</details>

------------------------------------------------------------------------

## ¿Qué edad tiene YG?


![YG](images/YG_25.jpeg)
<details>

<summary>Mostrar gráficos de todas las estimaciones</summary>

```{r, echo=FALSE}
plots_yg
```

</details>

------------------------------------------------------------------------

## ¿Qué edad tiene OR?


![OR](images/OR_77.jpeg)
<details>

<summary>Mostrar gráficos de todas las estimaciones</summary>

```{r, echo=FALSE}
plots_or
```

</details>

------------------------------------------------------------------------

## ¿Qué edad tiene TR?


![TR](images/TR_37.jpeg)
<details>

<summary>Mostrar gráficos de todas las estimaciones</summary>

```{r, echo=FALSE}
plots_tr
```

</details>

------------------------------------------------------------------------

## ¿Qué edad tiene BA?


![BA](images/BA_02.jpeg)
<details>

<summary>Mostrar gráficos de todas las estimaciones</summary>

```{r, echo=FALSE}
plots_ba
```

</details>

------------------------------------------------------------------------

## ¿Qué edad tiene AW?


![AW](images/AW_24.jpeg)
<details>

<summary>Mostrar gráficos de todas las estimaciones</summary>

```{r, echo=FALSE}
plots_aw
```

</details>