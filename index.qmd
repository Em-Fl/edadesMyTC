---
title: "¿Qué tan bueno sos estimando la edad de las personas?"
format: html
---

# Bienvenidos a la actividad 'Adivinando edades'

A continuación encontrarás un conjunto de fotos. Selecciona los links para indicar qué edad piensas que tienen las personas
------------------------------------------------------------------------

```{r, echo=FALSE, message=FALSE, warning=FALSE}
# --- Load packages ---
if (!require("googlesheets4")) install.packages("googlesheets4")
if (!require("plotly")) install.packages("plotly")
library(googlesheets4)
library(plotly)

# --- Load data from Google Sheets ---
sheet_url <- "https://docs.google.com/spreadsheets/d/1Af5_4F3JKp_iCsAC8mxVnmZp8_DdzicnO7Af384txZ4"

# Skip authentication for public sheet
gs4_deauth()

read_sheet_safe <- function(sheet_name) {
  df <- read_sheet(sheet_url, sheet = sheet_name)
  # Keep only relevant columns
  df <- df[, c("Tus iniciales (dos letras)", "¿Qué edad tiene?")]
  names(df) <- c("initials", "age")
  df$age <- as.numeric(df$age)
  df <- df[!is.na(df$age) & df$age > 0 & df$age < 120, ]
  df$Group <- sheet_name
  return(df)
}

dc_data <- read_sheet_safe("DC")
cm_data <- read_sheet_safe("CM")
all_data <- rbind(dc_data, cm_data)

# --- Plotting function ---
create_plots <- function(df, title) {
  mean_age <- mean(df$age)
  median_age <- median(df$age)
  var_age <- var(df$age)
  sd_age <- sd(df$age)
  
  hist_counts <- hist(df$age, plot = FALSE)
  max_count <- max(hist_counts$counts)
  
  # Histogram
  hist <- plot_ly(df, x = ~age, type = "histogram",
                  marker = list(color = "#9bfa82", line = list(color = "#6446faff", width = 1)),
                  showlegend = FALSE) %>%
    add_trace(x = c(mean_age, mean_age), y = c(0, max_count), type = "scatter", mode = "lines",
              line = list(color = "#ff6b6b", width = 3), name = paste0("Media: ", round(mean_age,1)),
              showlegend = TRUE) %>%
    add_trace(x = c(median_age, median_age), y = c(0, max_count), type = "scatter", mode = "lines",
              line = list(color = "#6446faff", width = 3), name = paste0("Mediana: ", round(median_age,1)),
              showlegend = TRUE) %>%
    layout(
      bargap = 0,
      xaxis = list(title = "Edad"),
      yaxis = list(title = "Frecuencia"),
      annotations = list(
        x = 0.95, y = 0.95, xref = "paper", yref = "paper",
        text = paste0("Varianza: ", round(var_age,1), "<br>DE: ", round(sd_age,1)),
        showarrow = FALSE, font = list(size = 14)
      )
    )
  
  # Boxplot
  box <- plot_ly(df, x = ~age, type = "box", boxpoints = "all", jitter = 0.3,
                 orientation = "h", fillcolor = "#9bfa82",
                 marker = list(color = "#6446faff"),
                 line = list(color = "#6446faff"),
                 showlegend = FALSE) %>%
    layout(xaxis = list(title = "Edad"), yaxis = list(showticklabels = FALSE))
  
  return(subplot(hist, box, nrows = 2, margin = 0.07, shareX = TRUE, titleX = TRUE) %>%
           layout(title = title))
}

plots_dc <- create_plots(all_data[all_data$Group=="DC",], "DC: Distribución de edades")
plots_cm <- create_plots(all_data[all_data$Group=="CM",], "CM: Distribución de edades")

```

------------------------------------------------------------------------

## DC

![DC](images/DC_19.jpg)

[¿Qué edad tiene DC?](https://docs.google.com/forms/d/e/1FAIpQLSeRYPxegq2BLlMnuyNononGdwGwAtuFgRudS3lgUBV5M_xvZw/viewform?usp=pp_url&entry.1674617589)

<details>

<summary>Mostrar gráficos de todas las estimaciones</summary>

```{r, echo=FALSE}
plots_dc
```

</details>

------------------------------------------------------------------------

## CM

![CM](images/CM_25.jpg)

[¿Qué edad tiene CM?](https://docs.google.com/forms/d/e/1FAIpQLScoD5wOyHaf8Rb26P01ogBlIpkBkssDnjvRbMHtGgYu9wKU-w/viewform?usp=pp_url&entry.1674617589)

<details>

<summary>Mostrar gráficos de todas las estimaciones</summary>

```{r, echo=FALSE}
plots_cm
```

</details>
